<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <style>
        @charset "UTF-8";
        body {
            font-family: "Avenir Next", "Helvetica Neue", Arial, sans-serif;
            margin: 0; padding: 0; background-color: #292929; color: #FFFFFF;
            width: 1200px; height: 1653px; overflow: hidden;
        }

        /* --- ヘッダー・スタッツ --- */
        .header { display: flex; height: 350px; width: 100%; }
        .team-box { width: 50%; padding: 20px 40px; position: relative; display: flex; flex-direction: column; justify-content: space-between; box-sizing: border-box; overflow: hidden; }
        
        .home { background-color: __HOME_BG__ !important; color: #FFFFFF !important; }
        .away { background-color: __AWAY_BG__ !important; color: #FFFFFF !important; }

        .accent {
            position: absolute;
            top: 0;
            left: 0;
            width: 350px;
            height: 350px;
            z-index: 1;
            background: linear-gradient(135deg, var(--accent-color) 50%, transparent 50%)!important;
            pointer-events: none;
        }
        .home .accent { --accent-color: __HOME_DARK__ !important; }
        .away .accent { --accent-color: __AWAY_DARK__ !important; }

        .city-part, .nick-part, .score-val { position: relative; z-index: 5; }
        
        .city-part {
            font-size: 35px; font-weight: 600; letter-spacing: 0.1em; line-height: 1.0;
            margin-top: 13px; margin-bottom: 14px; color: #FFFFFF !important;
        }

        .nick-part {
            font-size: 56px; font-weight: 700; letter-spacing: 0.13em; line-height: 1;
            margin-top: 0px; white-space: nowrap; display: block; width: 100%;
            overflow: visible; color: #FFFFFF !important;
        }

        .score-val {
            font-size: 115px; font-weight: 700; text-align: right; line-height: 0.8;
            margin-top: auto; margin-bottom: 20px; letter-spacing: 0.16em;
            margin-right: -0.16em; color: #FFFFFF !important; position: relative; z-index: 5;
        }

        .winner-color { color: #FFD932 !important; }

        .sub-header {
            background-color: #292929; height: 173px; display: flex;
            justify-content: space-between; align-items: flex-start;
            padding: 30px 40px 0 40px; box-sizing: border-box;
        }

        .info-left {
            display: flex;
            flex-direction: column;
            gap: 15px;
            width: 835px;
        }

        .info-row-top {
            display: flex;
            flex-direction: row;
        }

        .info-row-bottom {
            display: flex;
        }

        .info-item {
            display: flex;
            align-items: baseline;
            margin-right: 50px;
        }

        .info-item:nth-child(1) {
            max-width: none;
        }

        .info-item:nth-child(2) {
            flex-grow: 0; 
            max-width: none;
        }

        .info-label {
            color: #888;
            font-size: 30px;
            font-weight: 0;
            margin-right: 20px;
            width: auto;
            font-family: 'Arial Black', sans-serif;
            letter-spacing: 0.2em;
        }

        .info-value {
            font-size: 32px;
            font-weight: 600;
            font-family: "Avenir Next", "AvenirNext-Bold", "Arial Black", sans-serif;
            letter-spacing: 0.13em;
            display: inline-block;
            white-space: nowrap;
            width: auto; /* バッジにぶつからない限界の幅 */
            max-width: 750px;
            overflow: hidden; /* はみ出た分を隠す（JSが動くまでの保険） */
            text-overflow: clip;
            
        }

        .info-right {
            display: flex;
            flex-direction: column;
            gap: 16px;
            align-items: flex-end;
            margin-top: -5px;
        }

        .category-badge, .round-badge {
            background-color: #FFFFFF;
            color: #000000;
            text-align: center;
            width: 300px;
            border-radius: 2px;
            text-transform: uppercase;
            font-family: "Avenir Next", "AvenirNext-Bold", "Arial Black", sans-serif;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .category-badge {
            height: 58px;
            font-size: 30px;
            font-weight: 700;
            letter-spacing: 0.2em;
        }

        .round-badge {
            height: 58px;
            font-size: 24px;
            font-weight: 700;
            letter-spacing: 0.1em;
        }

        .stats-section { background-color: #292929; width: 100%; }
        .stats-grid-container { display: grid; grid-template-columns: repeat(10, 1fr); width: 100%; }
        .stat-cell {
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            padding: 15px 0; text-align: center;
            background-image: linear-gradient(to bottom, #FFFFFF 40%, rgba(255,255,255,0) 0%);
            background-position: right; background-size: 2px 10px; background-repeat: repeat-y;
        }
        .stat-cell:last-child { background-image: none; }

        .home-row { background-color: __HOME_BG__ !important; color: #FFFFFF !important; height: 100px; }
        .away-row { background-color: __AWAY_BG__ !important; color: #FFFFFF !important; height: 100px; }
        .label-row { background-color: #292929; height: 60px; }

        .val-main { font-size: 28px; font-weight: 600; line-height: 1.2; letter-spacing: 0.1em; color: #FFFFFF !important; }
        .val-sub { font-size: 19px; font-weight: 600; color: #FFFFFF !important; margin-top: 20px; letter-spacing: 0.1em; }
        .stat-label { color: #ffffff; font-size: 28px; font-weight: 600; letter-spacing: 0.1em; }

        .charts-area { padding: 20px 30px; display: flex; flex-direction: column; gap: 40px; }
        .chart-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 40px; }
        .chart-box { display: flex; flex-direction: column; align-items: center; }
        .chart-title {
            width: 100%; text-align: center; font-size: 24px; font-weight: 600;
            border: 2.5px solid #FFF; padding: 8px 0; margin-bottom: 15px;
            letter-spacing: 0.2em; text-transform: uppercase;
        }
        .charts-wrapper { display: flex; justify-content: space-around; align-items: center; width: 100%; height: 220px; }
        
        .fg-container { display: flex; align-items: center; gap: 15px; width: 100%; }
        .fg-label-box {
            width: 280px; flex-shrink: 0; font-size: 22px; font-weight: 600;
            border: 2.5px solid #FFF; padding: 10px 0; text-align: center;
            letter-spacing: 0.1em; text-transform: uppercase;
        }
        .bar-row-wrapper { flex-grow: 1; }
        .bar-row { display: flex; height: 30px; width: 100%; gap: 20px; }
        .bar-group { display: flex; flex-direction: column; flex: 1; }
        .bar-main-row { display: flex; height: 30px; width: 100%; background: #222; position: relative; }
        .bar-main-row::after {
            content: ""; position: absolute; top: -5px; height: calc(100% + 10px); left: 0; width: 100%;
            background-image: linear-gradient(90deg, #FFF 2px, transparent 2px), linear-gradient(90deg, #FFF 2px, transparent 2px), linear-gradient(90deg, #FFF 2px, transparent 2px);
            background-position: 0% 0, 50% 0, 100% 0; background-size: 2px 100%; background-repeat: no-repeat; z-index: 10;
        }
        .bar-item {
            width: calc(var(--w) * 1%); 
            height: 100%; 
            display: flex; 
            align-items: center;
            font-size: 34px; 
            font-weight: 600; 
            z-index: 5;
            padding: 0 10px;
            box-sizing: border-box;
        }
        .a-3p, .h-3p {
           justify-content: flex-end;
        }

        .bar-legend-container { display: flex; justify-content: center; gap: 30px; margin-top: 10px; }
        .legend-item { display: flex; align-items: center; font-size: 20px; font-weight: 600; color: #FFFFFF; }
        .legend-rect { width: 18px; height: 18px; margin-right: 8px; border-radius: 2px; }

        .h-2p { background: __HOME_BG__ !important; color: #FFFFFF !important; }
        .h-3p { background: __HOME_COLOR2__ !important; color: #FFFFFF !important; }
        .a-2p { background: __AWAY_BG__ !important; color: #FFFFFF !important; border-left: 3px solid #292929; }
        .a-3p { background: __AWAY_COLOR2__ !important; color: #FFFFFF !important; }

        .pie-legend-container { display: flex; justify-content: space-around; width: 100%; margin-top: 15px; }
        .pie-legend { display: flex; justify-content: center; gap: 15px; font-size: 22px; font-weight: 600; color: #FFFFFF; }
        .dot { width: 18px; height: 18px; border-radius: 50%; display: inline-block; margin-right: 6px; }

        .starter-section { padding: 0 60px; margin-top: 15px; display: flex; flex-direction: column; align-items: center; }
        .starter-title {
            border: 2.5px solid #FFF; display: block; width: calc(104% - 0px); padding: 4px 0;
            font-size: 24px; font-weight: 600; margin-bottom: 20px; letter-spacing: 0.2em;
            text-align: center; text-transform: uppercase;
        }
        .starter-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 25px; width: 105%; }
        .stat-header {
            display: flex; justify-content: flex-end; gap: 10px; font-size: 20px;
            font-weight: 650; color: #FFFFFF; margin-bottom: 5px; padding-right: 5px;
        }
        .stat-header span { width: 45px; text-align: center; }
        .player-row { 
            display: flex; 
            align-items: center; 
            margin-bottom: 5px; 
            padding-bottom: 5px; 
            position: relative;
        }
        .p-num {
            color: #FFFFFF !important; width: 45px; height: 40px; display: flex;
            align-items: center; justify-content: center; font-weight: 600; font-size: 22px; margin-right: 10px;
        }
        #home-starters .p-num { background-color: __HOME_BG__ !important; }
        #away-starters .p-num { background-color: __AWAY_BG__ !important; }
        .p-name { 
            font-size: 24px; 
            font-weight: 600; 
            letter-spacing: 0.1em; 
            width: auto; 
            display: inline-block;
            white-space: nowrap;
            text-transform: none; 
        }
        .p-name-container {
           width: 280px; 
            display: block;
            overflow: hidden;
        }

        .p-stats { 
            font-size: 20px; 
            font-weight: 600; 
            color: #FFFFFF; 
            display: flex; 
            gap: 25px; 
            align-items: center; 
            margin-left: auto;
            width: 210px;
            justify-content: flex-end;
        }
        .p-min { width: 50px; text-align: center; }
        .p-val { width: 40px; text-align: center; }
        .p-name, .p-stats, .p-min, .p-val, .stat-header, .p-num { color: #FFFFFF !important; }
    </style>
</head>
<body>
    <div class="header">
        <div class="team-box away">
            <div class="accent"></div>
            <div>
                <div class="city-part">__AWAY_CITY__</div>
                <div class="nick-part">__AWAY_NICK__</div>
            </div>
            <div class="score-val" id="score-a">__AWAY_SCORE__</div>
        </div>
        <div class="team-box home">
            <div class="accent"></div>
            <div>
                <div class="city-part">__HOME_CITY__</div>
                <div class="nick-part">__HOME_NICK__</div>
            </div>
            <div class="score-val" id="score-h">__HOME_SCORE__</div>
        </div>
    </div>

    <div class="sub-header">
        <div class="info-left">
            <div class="info-row-top">
                <div class="info-item"><span class="info-label">Date</span><span class="info-value">__DATE__</span></div>
                <div class="info-item"><span class="info-label">Attendance</span><span class="info-value">__ATTENDANCE__</span></div>
            </div>
            <div class="info-row-bottom">
                <div class="info-item"><span class="info-label">Location</span><span class="info-value">__VENUE__</span></div>
            </div>
        </div>
        <div class="info-right">
            <div class="category-badge">__LEAGUE_TYPE__</div>
            <div class="round-badge">__ROUND__</div>
        </div>
    </div>

    <div class="stats-section">
        <div class="stats-grid-container away-row">
            <div class="stat-cell"><span class="val-main">__A_FGPCT__%</span><span class="val-sub">__A_FGSTR__</span></div>
            <div class="stat-cell"><span class="val-main">__A_2FGPCT__%</span><span class="val-sub">__A_2FGSTR__</span></div>
            <div class="stat-cell"><span class="val-main">__A_3FGPCT__%</span><span class="val-sub">__A_3FGSTR__</span></div>
            <div class="stat-cell"><span class="val-main">__A_FTPCT__%</span><span class="val-sub">__A_FTSTR__</span></div>
            <div class="stat-cell"><span class="val-main">__A_REB__</span><span class="val-sub">__A_OREB__ - __A_DREB__</span></div>
            <div class="stat-cell"><span class="val-main">__A_AST__</span></div>
            <div class="stat-cell"><span class="val-main">__A_TOV__</span></div>
            <div class="stat-cell"><span class="val-main">__A_STL__</span></div>
            <div class="stat-cell"><span class="val-main">__A_BLK__</span></div>
            <div class="stat-cell"><span class="val-main">__A_PF__</span></div>
        </div>
        <div class="stats-grid-container label-row">
            <div class="stat-cell"><span class="stat-label">FG</span></div>
            <div class="stat-cell"><span class="stat-label">2FG</span></div>
            <div class="stat-cell"><span class="stat-label">3FG</span></div>
            <div class="stat-cell"><span class="stat-label">FT</span></div>
            <div class="stat-cell"><span class="stat-label">REB</span></div>
            <div class="stat-cell"><span class="stat-label">AST</span></div>
            <div class="stat-cell"><span class="stat-label">TOV</span></div>
            <div class="stat-cell"><span class="stat-label">STL</span></div>
            <div class="stat-cell"><span class="stat-label">BLK</span></div>
            <div class="stat-cell"><span class="stat-label">PF</span></div>
        </div>
        <div class="stats-grid-container home-row">
            <div class="stat-cell"><span class="val-main">__H_FGPCT__%</span><span class="val-sub">__H_FGSTR__</span></div>
            <div class="stat-cell"><span class="val-main">__H_2FGPCT__%</span><span class="val-sub">__H_2FGSTR__</span></div>
            <div class="stat-cell"><span class="val-main">__H_3FGPCT__%</span><span class="val-sub">__H_3FGSTR__</span></div>
            <div class="stat-cell"><span class="val-main">__H_FTPCT__%</span><span class="val-sub">__H_FTSTR__</span></div>
            <div class="stat-cell"><span class="val-main">__H_REB__</span><span class="val-sub">__H_OREB__ - __H_DREB__</span></div>
            <div class="stat-cell"><span class="val-main">__H_AST__</span></div>
            <div class="stat-cell"><span class="val-main">__H_TOV__</span></div>
            <div class="stat-cell"><span class="val-main">__H_STL__</span></div>
            <div class="stat-cell"><span class="val-main">__H_BLK__</span></div>
            <div class="stat-cell"><span class="val-main">__H_PF__</span></div>
        </div>
    </div>

    <div class="charts-area">
        <div class="chart-grid">
            <div class="chart-box">
                <div class="chart-title">PTS RATIO</div>
                <div class="charts-wrapper">
                    <canvas id="pAway" width="250" height="250"></canvas>
                    <canvas id="pHome" width="250" height="250"></canvas>
                </div>
                <div class="pie-legend-container">
                    <div class="pie-legend">
                        <span><span class="dot" style="background:__AWAY_BG__"></span>2P</span>
                        <span><span class="dot" style="background:__AWAY_COLOR2__"></span>3P</span>
                        <span><span class="dot" style="background:#888888"></span>FT</span>
                    </div>
                    <div class="pie-legend">
                        <span><span class="dot" style="background:__HOME_BG__"></span>2P</span>
                        <span><span class="dot" style="background:__HOME_COLOR2__"></span>3P</span>
                        <span><span class="dot" style="background:#888888"></span>FT</span>
                    </div>
                </div>
            </div>

            <div class="chart-box">
                <div class="chart-title">3POINT PERCENTAGE</div>
                <div class="charts-wrapper">
                    <canvas id="dAway" width="235" height="235"></canvas>
                    <canvas id="dHome" width="235" height="235"></canvas>
                </div>
            </div>
        </div>

        <div class="fg-container">
            <div class="fg-label-box">FG Attempt RATIO</div>
            <div class="bar-row-wrapper">
                <div class="bar-row">
                    <div class="bar-group away-side">
                        <div class="bar-main-row">
                            <div class="bar-item a-2p" style="width: __A_ATT_2P__">__A_ATT_2P__</div>
                            <div class="bar-item a-3p" style="width: __A_ATT_3P__; color: __AWAY_TEXT2__ !important;">__A_ATT_3P__</div>
                        </div>
                        <div class="bar-legend-container">
                            <div class="legend-item"><span class="legend-rect" style="background:__AWAY_BG__"></span>2P</div>
                            <div class="legend-item"><span class="legend-rect" style="background:__AWAY_COLOR2__"></span>3P</div>
                        </div>
                    </div>
                    <div class="bar-group home-side">
                        <div class="bar-main-row">
                            <div class="bar-item h-2p" style="width: __H_ATT_2P__">__H_ATT_2P__</div>
                            <div class="bar-item h-3p" style="width: __H_ATT_3P__; color: __HOME_TEXT2__ !important;">__H_ATT_3P__</div>
                        </div>
                        <div class="bar-legend-container">
                            <div class="legend-item"><span class="legend-rect" style="background:__HOME_BG__"></span>2P</div>
                            <div class="legend-item"><span class="legend-rect" style="background:__HOME_COLOR2__"></span>3P</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="starter-section">
        <div class="starter-title">STARTING 5</div>
        <div class="starter-grid">
            <div>
                <div class="stat-header"><span class="min-label">MIN</span><span>PTS</span><span>REB</span><span>AST</span></div>
                <div id="away-starters">__AWAY_STARTERS_HTML__</div>
            </div>
            <div>
                <div class="stat-header"><span class="min-label">MIN</span><span>PTS</span><span>REB</span><span>AST</span></div>
                <div id="home-starters">__HOME_STARTERS_HTML__</div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2"></script>
    <script>
        window.drawReportCharts = (d) => {
            const scoreH = parseInt("__HOME_SCORE__");
            const scoreA = parseInt("__AWAY_SCORE__");
            const elH = document.getElementById('score-h');
            const elA = document.getElementById('score-a');
            if (scoreH > scoreA) elH.classList.add('winner-color');
            else if (scoreA > scoreH) elA.classList.add('winner-color');
            
            const venueEl = document.querySelector('.info-row-bottom .info-value');
            if (venueEl) {
                const MAX_V_W = 590; let v_sp = 0.13; let v_fs = 32;
                venueEl.style.letterSpacing = v_sp + "em"; venueEl.style.fontSize = v_fs + "px";
                while (venueEl.scrollWidth > MAX_V_W && v_fs > 18) {
                    if (v_sp > -0.15) v_sp -= 0.01; else v_fs -= 1;
                    venueEl.style.letterSpacing = v_sp + "em"; venueEl.style.fontSize = v_fs + "px";
                }
            }

            const adjustTextElements = () => {
                document.querySelectorAll('.team-box').forEach(box => {
                    const nick = box.querySelector('.nick-part');
                    if (!nick) return;
                    const maxWidth = box.clientWidth - 80;
                    let spacing = 0.13;
                    nick.style.letterSpacing = spacing + "em";
                    while (nick.scrollWidth > maxWidth && spacing > -0.25) {
                        spacing -= 0.005; nick.style.letterSpacing = spacing + "em";
                    }
                });
                document.querySelectorAll('.p-name').forEach(nameEl => {
                // 1. テキスト整形
                const originalText = nameEl.textContent;
                let formattedText = originalText.toLowerCase().replace(/(^\w|\s\w|-\w)/g, m => m.toUpperCase());

                // --- ★ここから追加：Iの連続を大文字に固定 ---
                // 文末の " Ii" を " II" に、" Iii" を " III" に置換します
                formattedText = formattedText.replace(/\bIi\b/g, 'II');
                formattedText = formattedText.replace(/\bIii\b/g, 'III');

                nameEl.textContent = formattedText;



                // 2. 「理想の初期値」をセット
                let fontSize = 24; 
                let spacing = 0.1; // 短い選手が綺麗に見える広めの間隔
                const MAX_WIDTH = 260; // 隣のスタッツと被らない限界値

                // まず理想のサイズを適用
                nameEl.style.fontSize = fontSize + "px";
                nameEl.style.letterSpacing = spacing + "em";

                // 3. はみ出している場合のみ調整ループに入る
                // scrollWidthがMAX_WIDTHを超えていないなら、このループは1回も実行されません
                if (nameEl.scrollWidth > MAX_WIDTH) {
                    // まずは文字間隔を標準まで詰める
                    while (nameEl.scrollWidth > MAX_WIDTH && spacing > 0) {
                        spacing -= 0.02;
                        nameEl.style.letterSpacing = spacing + "em";
                    }
        
                    // それでもダメなら、文字間隔をマイナスまで攻める
                    while (nameEl.scrollWidth > MAX_WIDTH && spacing > -0.12) {
                        spacing -= 0.01;
                        nameEl.style.letterSpacing = spacing + "em";
                    }

                    // 最後にフォントサイズを小さくする
                    while (nameEl.scrollWidth > MAX_WIDTH && fontSize > 16) {
                        fontSize -= 0.5;
                        nameEl.style.fontSize = fontSize + "px";
                    }
                }
            });
            };
            adjustTextElements();

            if(!d || !d.h) return;
            Chart.register(ChartDataLabels);
            const colors = {
                h_main: '__HOME_BG__', h_sub: '__HOME_COLOR2__', h_text2: '__HOME_TEXT2__',
                a_main: '__AWAY_BG__', a_sub: '__AWAY_COLOR2__', a_text2: '__AWAY_TEXT2__'
            };

            const pieCfg = (labels, data, bgColors, textColors) => ({
                type: 'pie',
                data: { labels, datasets: [{ data, backgroundColor: bgColors, borderWidth: 0 }] },
                options: {
                    responsive: false, animation: false, layout: { padding: 15 },
                    plugins: {
                        legend: { display: false },
                        datalabels: {
                            // index(1) つまり 3P の時だけ、指定した text2 カラーを適用
                            color: (ctx) => {
                                return textColors[ctx.dataIndex] || '#FFFFFF';
                            },
                            font: { weight: '700', size: 36 },
                            anchor: 'end', align: 'start', offset: -10,
                            formatter: (v, ctx) => {
                                let sum = ctx.dataset.data.reduce((a, b) => a + b, 0);
                                return v ? (v * 100 / sum).toFixed(0) + "%" : '';
                            }
                        }
                    }
                }
            });

            // AWAYの円グラフ（3Pのテキストカラーに a_text2 を指定）
            new Chart(document.getElementById('pAway'), pieCfg(
                ['2P','3P','FT'], 
                [d.a.r2, d.a.r3, d.a.rf], 
                [colors.a_main, colors.a_sub, '#888888'],
                ['#FFFFFF', colors.a_text2, '#FFFFFF'] // ここで色を配列で渡す
            ));

            // HOMEの円グラフ（3Pのテキストカラーに h_text2 を指定）
            new Chart(document.getElementById('pHome'), pieCfg(
                ['2P','3P','FT'], 
                [d.h.r2, d.h.r3, d.h.rf], 
                [colors.h_main, colors.h_sub, '#888888'],
                ['#FFFFFF', colors.h_text2, '#FFFFFF'] // ここで色を配列で渡す
            ));

            const drawDonut = (canvasId, val, color) => {
                new Chart(document.getElementById(canvasId), {
                    type: 'doughnut',
                    data: { datasets: [{ data: [val, 100 - val], backgroundColor: [color, '#5e5e5e'], borderWidth: 0 }] },
                    options: { responsive: false, animation: false, cutout: '70%', plugins: { datalabels: { display: false } } },
                    plugins: [{
                        id: 'centerText',
                        afterDraw: (chart) => {
                            const { ctx, width, height } = chart;
                            ctx.save(); ctx.font = "bold 40px 'Avenir Next'"; ctx.fillStyle = "white";
                            ctx.textAlign = "center"; ctx.textBaseline = "middle";
                            ctx.fillText(val.toFixed(1) + "%", width / 2, height / 2); ctx.restore();
                        }
                    }]
                });
            };
            drawDonut('dAway', d.a.p3, colors.a_main);
            drawDonut('dHome', d.h.p3, colors.h_main);
        };
    </script>
</body>
</html>