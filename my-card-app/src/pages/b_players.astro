---
export const prerender = false;
import Layout from '../layouts/Layout.astro';

const { searchParams } = Astro.url;
const playerName = searchParams.get('name') || "PLAYER";
const playerImg = searchParams.get('img') || "";

// フォルダパスからリーグ（B1 or B2）を推測してラベル表示に使用
const isB2 = playerImg.includes('/B2/');
const leagueLabel = isB2 ? "B2 LEAGUE" : "B1 LEAGUE";
---

<Layout title={`${playerName} | BDL PLAYERS`}>
  <main class="bg-[#1a1a1a] min-h-screen text-white font-avenir relative overflow-x-hidden">
    
    {playerImg && (
      <div class="absolute top-0 left-1/2 -translate-x-1/2 w-full h-[70vh] opacity-20 blur-[100px] pointer-events-none">
        <img src={playerImg} class="w-full h-full object-cover" />
      </div>
    )}

    <header class="relative z-10 pt-12 pb-6 px-8 text-center">
      <button onclick="history.back()" class="absolute left-6 top-12 p-4 text-white/40 hover:text-white transition-colors">
        <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" fill="currentColor" viewBox="0 0 16 16">
          <path fill-rule="evenodd" d="M11.354 1.646a.5.5 0 0 1 0 .708L5.707 8l5.647 5.646a.5.5 0 0 1-.708.708l-6-6a.5.5 0 0 1 0-.708l6-6a.5.5 0 0 1 .708 0z"/>
        </svg>
      </button>
      <h1 class="text-[10px] font-black uppercase tracking-[0.5em] opacity-30">Player Collection</h1>
    </header>

    <div class="relative z-10 max-w-lg mx-auto px-8 pb-32">
      <div class="mt-4">
        <div class="rounded-3xl overflow-hidden border border-white/10 shadow-[0_20px_60px_rgba(0,0,0,0.8)] bg-black/40">
          <img src={playerImg} alt={playerName} class="w-full h-auto block" />
        </div>
        
        <div class="mt-12 space-y-3">
          <div class="flex items-center gap-2">
             <span class={`text-[10px] font-black px-2 py-0.5 rounded ${isB2 ? 'bg-orange-600' : 'bg-blue-600'}`}>
               {leagueLabel}
             </span>
          </div>
          <h2 class="text-4xl font-black uppercase tracking-tighter leading-tight">{playerName}</h2>
        </div>

        <div class="mt-12 grid grid-cols-1 gap-4">
          <a href={playerImg} download={`${playerName}.png`} class="w-full bg-white text-black py-5 rounded-2xl font-black text-center uppercase tracking-widest text-[12px] hover:scale-[1.02] active:scale-95 transition-all shadow-xl">
            Download Card
          </a>
          <button id="share-btn" class="w-full bg-white/5 border border-white/10 py-5 rounded-2xl font-black text-center uppercase tracking-widest text-[12px] hover:bg-white/10 transition-all">
            Share Link
          </button>
        </div>
      </div>
    </div>

    <div class="fixed bottom-8 left-1/2 -translate-x-1/2 z-40">
      <a href="/" class="bg-gray-900/90 backdrop-blur-md text-white px-10 py-4 rounded-full font-black text-[10px] uppercase tracking-widest shadow-2xl border border-white/10 whitespace-nowrap">
        Portal Home
      </a>
    </div>
  </main>
</Layout>

<script>
  const shareBtn = document.getElementById('share-btn');
  shareBtn?.addEventListener('click', async () => {
    if (navigator.share) {
      try {
        await navigator.share({ title: 'BDL PLAYER CARD', url: window.location.href });
      } catch (err) { console.log('Share failed'); }
    } else {
      alert('Link copied to clipboard!');
      navigator.clipboard.writeText(window.location.href);
    }
  });
</script>